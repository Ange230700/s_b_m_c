%% docs\mvp\diagrams\order_lifecycle.mmd

stateDiagram-v2
    [*] --> Pending

    %% Core lifecycle
    Pending --> Confirmed: confirmOrder()
    Confirmed --> OutForDelivery: startDelivery()
    OutForDelivery --> Delivered: markDelivered()

    %% Cancellation paths
    Pending --> Cancelled: cancelOrder()
    Confirmed --> Cancelled: cancelOrder()
    OutForDelivery --> Cancelled: cancelDelivery()

    %% Terminal states
    Delivered --> [*]
    Cancelled --> [*]

    %% Internal notes
    state PendingState {
        note right of Pending
            - Order just created
            - Stock reserved (or not, depending on policy)
            - Awaiting manual validation
        end note
    }

    state ConfirmedState {
        note right of Confirmed
            - Order validated by admin
            - Stock definitely reserved
            - Ready for preparation / packing
        end note
    }

    state OutForDeliveryState {
        note right of OutForDelivery
            - With delivery person
            - Cannot change items/size
        end note
    }

    state DeliveredState {
        note right of Delivered
            - Final state
            - No further mutations allowed
        end note
    }

    state CancelledState {
        note right of Cancelled
            - Final state
            - Optional: restock items
        end note
    }
